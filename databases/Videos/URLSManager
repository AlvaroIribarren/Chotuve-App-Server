const VideoManager = require("./VideosManager")
const AxiosManager = require("../ExternalManagers/AxiosManager")

const VIDEOS_URL = "https://chotuve-media-server-g5-dev.herokuapp.com/videos";
const IMAGES_URL = "https://chotuve-media-server-g5-dev.herokuapp.com/images"

async function getAllUrls(){
    const response =  await AxiosManager.getResponseByLink(VIDEOS_URL);
    return response.data;
}

async function getUrlById(id){
    const str = "/" + id;
    const link = VIDEOS_URL + str;
    const res = await AxiosManager.getResponseByLink(link);
    if (res)
        return res.data[0];
    else
        return null;
}

async function addUrlsToVideos(videos){
    const listOfVideos = [];
    for (let video of videos){
        const url = await getUrlById(video.id);
        if (url) {
            video.url = url.url;
            listOfVideos.push(video);
        } else {
            console.log("No se encontro un video con id: " + video);
        }
    }
    return listOfVideos;
}

async function getAllVideosWithAddedUrls(videos){
    return await addUrlsToVideos(videos);
}

async function postVideoToMedia(video){
    return await AxiosManager.generatePost(VIDEOS_URL, video);
}

async function postImageToMedia(image){
    return await AxiosManager.generatePost(IMAGES_URL, image);
}


const URLManager = {}
URLManager.addUrlsToVideos = addUrlsToVideos;
URLManager.getUrlById = getUrlById;
URLManager.getAllUrls = getAllUrls;
URLManager.getAllVideosWithAddedUrls = getAllVideosWithAddedUrls;
URLManager.postVideoToMedia = postVideoToMedia;
URLManager.postImageToMedia = postImageToMedia;

module.exports = URLManager;